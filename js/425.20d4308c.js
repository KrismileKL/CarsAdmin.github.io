"use strict";(self["webpackChunkcars_admin"]=self["webpackChunkcars_admin"]||[]).push([[425],{3185:function(t,e,a){a.d(e,{Z:function(){return u}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-cascader",{class:{"cascader-input":t.initValueFlag},attrs:{filterable:"",placeholder:t.initValue,options:t.cascader_options,props:t.cascader_props},on:{change:t.changeValue},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},n=[],s=a(9322),i={name:"",data(){const t=this;return{address:[],addressData:{},value:[],cascader_options:[],cascader_props:{lazy:!0,lazyLoad(e,a){const r=e.level,n={},i={0:{type:"province"},1:{type:"city",code:"province"},2:{type:"area",code:"city"}};i[r].code&&(n[`${i[r].code}_code`]=e.value),n.type=i[r].type,(0,s.Df)(n).then((e=>{const n=e.data.data,s=i[r].type.toUpperCase();n.forEach((t=>{t.value=t[`${s}_CODE`],t.label=t[`${s}_NAME`],2===r&&(t.leaf=r>=2)})),t.addressData[i[r].type]=n,a(n)})),0!==e.level&&t.getAddress(e)}},initValue:"请选择省市区",initValueFlag:!1}},methods:{initDefault(t){t&&(this.initValueFlag=!0,this.initValue=t.split(",").join(" / "))},changeValue(t){this.$emit("update:cityAreaValue",t.join());const e=t[t.length-1],a=this.addressData.area.filter((t=>t.value==e))[0];this.address[2]=a.label,this.getAddress()},getAddress(t){if(t){const e=t.level-1;this.address[e]=t.label}this.mapLocation&&this.$emit("callback",{function:"setMapCenter",data:{address:this.address.join("")}})},clear(){console.log(11111),this.value=""}},components:{},props:{mapLocation:{type:Boolean,default:!1},cityAreaValue:{type:String,default:""}}},o=i,l=a(1001),d=(0,l.Z)(o,r,n,!1,null,"1a447781",null),u=d.exports},6425:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"parking-add"},[a("VueForm",{ref:"vuForm",attrs:{formData:t.form_data,formItme:t.form_item,formHandler:t.form_handler},scopedSlots:t._u([{key:"city",fn:function(){return[a("CityArea",{ref:"cityArea",attrs:{mapLocation:!0,cityAreaValue:t.form_data.area},on:{"update:cityAreaValue":function(e){return t.$set(t.form_data,"area",e)},"update:city-area-value":function(e){return t.$set(t.form_data,"area",e)},callback:t.callbackComponent}})]},proxy:!0},{key:"amap",fn:function(){return[a("div",{staticClass:"address-map"},[a("AMap",{ref:"amap",attrs:{options:t.option_map},on:{callback:t.callbackComponent}})],1)]},proxy:!0}])})],1)},n=[],s=(a(7658),a(427)),i=a(3185),o=a(9466),l=a(4050),d={name:"ParkingAdd",data(){let t=(t,e,a)=>{e?a():a(new Error("请输入停车场名称"))},e=(t,e,a)=>{const r=/^[0-9]*$/;e?r.test(e)?a():a(new Error("请输入数字")):a(new Error("请输入可停放车辆"))};return{form_data:{parkingName:"",area:"",address:"",type:"",carsNumber:"",status:"",lnglat:""},form_item:[{type:"Input",label:"停车场名称",placeholder:"请输入停车场名称",prop:"parkingName",width:"200px",validator:[{validator:t,trigger:"change"}]},{type:"Slot",slotName:"city",prop:"area",label:"区域"},{type:"Input",label:"详细地址",placeholder:"请输入详细地址",prop:"address",required:!0},{type:"Radio",label:"类型",prop:"type",options:this.$store.state.config.parking_type,required:!0},{type:"Input",label:"可停放车辆",placeholder:"请输入数字类型",prop:"carsNumber",validator:[{validator:e,trigger:"change"}]},{type:"Radio",label:"禁启用",prop:"status",options:this.$store.state.config.radio_disabled},{type:"Slot",slotName:"amap",label:"位置"},{type:"Input",label:"经纬度",placeholder:"请输入详细地址",prop:"lnglat",disabled:!0}],form_handler:[{label:"确定",key:"submit",type:"danger",handler:()=>this.formValidate()},{label:"重置",key:"reset"}],id:this.$route.query.id,option_map:{mapLoad:!0},status:this.$store.state.config.radio_disabled,type:this.$store.state.config.parking_type,button_loading:!1}},components:{AMap:s.Z,CityArea:i.Z,VueForm:o.Z},beforeMount(){},mounted(){},methods:{formValidate(){this.$refs.vuForm.$refs.form.validate((t=>{if(!t)return console.log("error submit!!"),!1;this.id?this.editParking():this.addParking()}))},callbackComponent(t){t.function&&this[t.function](t.data)},mapLoad(){this.getDetaile()},addParking(){this.button_loading=!0,(0,l.QR)(this.form_data).then((t=>{this.$message({type:"primary",message:t.message}),this.button_loading=!1,this.reset("form")})).catch((t=>{this.button_loading=!1}))},editParking(){let t=JSON.parse(JSON.stringify(this.form_data));t.id=this.id,this.button_loading=!0,(0,l.wU)(t).then((t=>{this.$message({type:"primary",message:t.message}),this.button_loading=!1,this.$router.push({name:"ParkingIndex"})})).catch((t=>{this.button_loading=!1}))},getDetaile(){if(!this.id)return!1;(0,l.Ip)({id:this.id}).then((t=>{const e=t.data;for(let n in e)Object.keys(this.form_data).includes(n)&&(this.form_data[n]=e[n]);const a=e.lnglat.split(","),r={lng:a[0],lat:a[1]};this.$refs.amap.setMarker(r),this.$refs.cityArea.initDefault(e.region)}))},reset(t){this.$refs[t].resetFields(),this.$refs.cityArea.clear(),this.$refs.amap.clearMarker()},getLnglat(t){this.form_data.lnglat=t.lnglat.value},setMapCenter(t){this.$refs.amap.setMapCenter(t.address)}}},u=d,c=a(1001),p=(0,c.Z)(u,r,n,!1,null,"c702fc10",null),m=p.exports},427:function(t,e,a){a.d(e,{Z:function(){return h}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"amap-wrap"},[a("el-amap",{staticClass:"amap-demo",attrs:{vid:"amapContainer",events:t.events}})],1)},n=[],s=a(5275);function i(t){return{lng:t.lnglat.getLng(),lat:t.lnglat.getLat(),value:t.lnglat.getLng()+","+t.lnglat.getLat()}}function o(t,e){const a=new AMap.Geocoder;a.getLocation(t,(function(t,a){if(console.log(a),"complete"===t&&"OK"==a.info){let t=a.geocodes[0].location.lat,r=a.geocodes[0].location.lng;e.setCenter([r,t]),console.log(t,r)}}))}let l=null;function d(t,e){l&&(e.remove(l),l=null),l=new AMap.Marker({position:[t.lng,t.lat]}),e.add(l),e.setFitView()}function u(t){l&&(t.remove(l),l=null)}var c={name:"Amap",data(){return{lnglat:{},map:null,zoom:18,events:{}}},mounted(){s.lazyAMapApiLoaderInstance.load().then((()=>{this.mapCreate(),this.map.on("click",(t=>{const e=i(t);this.lnglat=e,this.$emit("callback",{function:"getLnglat",data:{lnglat:e}}),this.setMarker()}))}))},methods:{mapCreate(t){this.map=new AMap.Map("amapContainer",{center:[121.59996,31.197646],zoom:this.zoom}),this.map.on("complete",(()=>{this.mapLoad()}))},mapLoad(){this.options.mapLoad&&this.$emit("callback",{function:"mapLoad"})},mapDestroy(){this.map&&this.map.destroy()},setMapCenter(t){o(t,this.map)},setMarker(t){d(t||this.lnglat,this.map)},clearMarker(){u(this.map)}},props:{options:{type:Object,default:()=>{}}}},p=c,m=a(1001),f=(0,m.Z)(p,r,n,!1,null,null,null),h=f.exports},9322:function(t,e,a){a.d(e,{HG:function(){return l},oG:function(){return d},Df:function(){return i},Re:function(){return u},Hp:function(){return c},Vj:function(){return o}});var r=a(4471);const n={parkingList:"/parking/list/",parkingListDelete:"/parking/delete/",brandList:"/brand/list/",brandListDelete:"/brand/delete/",carsList:"/cars/list/",carsListDelete:"/cars/delete/",carsAttrList:"/carsAttr/list/",leaseList:"/lease/list/",memberList:"/member/list/",memberListDelete:"/member/delete/",orderList:"/order/list/"};var s=n;function i(t={}){return r.Z.request({method:"post",url:"/cityPicker/",data:t})}function o(t={}){return r.Z.request({method:"post",url:s[t.url],data:t.data})}function l(t={}){return r.Z.request({method:"post",url:s[t.url],data:t.data})}function d(t={}){return r.Z.request({method:"post",url:"/common/getCarsBrand/",data:t})}function u(t={}){return r.Z.request({method:"post",url:"/common/getParking/",data:t})}function c(t={}){return r.Z.request({method:"post",url:"/uploadImgToken/",data:t})}},4050:function(t,e,a){a.d(e,{Ip:function(){return s},QR:function(){return n},Y1:function(){return o},wU:function(){return i}});var r=a(4471);function n(t={}){return r.Z.request({method:"post",url:"/parking/add/",data:t})}function s(t={}){return r.Z.request({method:"post",url:"/parking/detailed/",data:t})}function i(t={}){return r.Z.request({method:"post",url:"/parking/edit/",data:t})}function o(t={}){return r.Z.request({method:"post",url:"/parking/status/",data:t})}}}]);